<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trumpet Practice Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }

        h2 {
            color: #34495e;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.5em;
        }

        h3 {
            color: #34495e;
            margin: 20px 0 10px 0;
            font-size: 1.2em;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav button {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .nav button:hover {
            background: #2980b9;
        }

        .nav button.active {
            background: #2c3e50;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: #229954;
        }

        button.secondary {
            background: #95a5a6;
        }

        button.secondary:hover {
            background: #7f8c8d;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }

        .tally {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        .tally-mark {
            width: 30px;
            height: 30px;
            border: 2px solid #3498db;
            border-radius: 5px;
            cursor: pointer;
            background: white;
            transition: background 0.3s;
        }

        .tally-mark.active {
            background: #3498db;
        }

        .session-list {
            margin-top: 20px;
        }

        .session-card {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .session-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .session-card p {
            margin: 5px 0;
            color: #555;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #27ae60;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            height: 40px;
            background: linear-gradient(to right, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            border-radius: 20px;
            position: relative;
            margin: 20px 0;
        }

        .slider-marker {
            position: absolute;
            top: -5px;
            width: 20px;
            height: 50px;
            background: #2c3e50;
            cursor: pointer;
            border-radius: 5px;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .export-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        @media print {
            .nav, button, .export-section {
                display: none;
            }
            .container {
                box-shadow: none;
            }
        }

        .quick-ref-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .ref-card {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #f39c12;
        }

        .ref-card h4 {
            color: #e67e22;
            margin-bottom: 10px;
        }

        .ref-card pre {
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .help-toggle {
            background: #fff3cd;
            border: 2px solid #f39c12;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 15px 0;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }

        .help-toggle:hover {
            background: #ffe8a1;
        }

        .help-toggle h4 {
            margin: 0;
            color: #e67e22;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-toggle .arrow {
            transition: transform 0.3s;
            font-weight: bold;
        }

        .help-toggle.active .arrow {
            transform: rotate(90deg);
        }

        .help-content {
            background: #fffef5;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 10px 0 20px 0;
            border-radius: 5px;
            display: none;
            line-height: 1.8;
        }

        .help-content.active {
            display: block;
        }

        .help-content ol, .help-content ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .help-content li {
            margin: 8px 0;
        }

        .help-content strong {
            color: #e67e22;
        }

        .help-tip {
            background: white;
            border: 2px solid #3498db;
            border-radius: 5px;
            padding: 12px;
            margin: 10px 0;
        }

        .help-tip::before {
            content: "üí° ";
            font-size: 1.2em;
        }

        .error-log {
            background: #fff5f5;
            border: 1px solid #fc8181;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }

        .error-log h4 {
            color: #c53030;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∫ Trumpet Practice Tracker</h1>
        <p style="color: #7f8c8d; margin-bottom: 20px;">Track your practice sessions, monitor progress, and eliminate errors systematically</p>

        <!-- QUICK ACCESS TALLY -->
        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #3498db;">
            <h3 style="margin-top: 0; color: #2c3e50;">‚ö° Quick Tally - 16-8 Process (64 daily reps)</h3>
            <p style="margin-bottom: 10px; color: #555;">Click each square when you do a quick 10-second drill throughout the day</p>
            <div class="form-group">
                <label for="quick-drill-select">Current drill I'm doing:</label>
                <select id="quick-drill-select" onchange="saveQuickDrill()" style="max-width: 400px;">
                    <option value="">Select drill...</option>
                    <option value="finger">Finger between teeth (throat open)</option>
                    <option value="turnaround">Turnaround breath (no grab at top)</option>
                    <option value="meerkat">No-meerkat check (ribs only)</option>
                    <option value="elbow">Elbow independence</option>
                    <option value="balloon">Passive release balloon</option>
                    <option value="custom">Custom drill</option>
                </select>
                <input type="text" id="quick-drill-custom" placeholder="Describe your custom drill..." style="max-width: 400px; margin-top: 5px; display: none;">
            </div>
            <div class="form-group">
                <label for="quick-message">My message each time:</label>
                <input type="text" id="quick-message" onchange="saveQuickMessage()" placeholder="Playing feels like..." style="max-width: 400px;">
            </div>
            <div class="tally" id="quick-tally"></div>
            <p style="margin-top: 10px; font-size: 1.2em;"><strong>Today's count: <span id="quick-tally-count" style="color: #3498db; font-size: 1.3em;">0</span>/64</strong></p>
            <div class="progress-bar" style="margin-top: 10px;">
                <div class="progress-fill" id="quick-progress" style="width: 0%;">0%</div>
            </div>
            <button type="button" class="secondary" onclick="resetQuickTally()" style="margin-top: 10px;">Reset Today's Tally</button>
        </div>

        <div class="nav">
            <button onclick="showSection('howto')" class="active">üìñ How to Use</button>
            <button onclick="showSection('daily')">Daily Practice</button>
            <button onclick="showSection('weekly')">Weekly Review</button>
            <button onclick="showSection('errors')">Error Trilogy</button>
            <button onclick="showSection('lessons')">üéì Lessons Log</button>
            <button onclick="showSection('progress')">Progress & Stats</button>
            <button onclick="showSection('reference')">Quick Reference</button>
            <button onclick="showSection('settings')">‚öôÔ∏è Settings</button>
            <button onclick="showSection('export')">Export/Import</button>
        </div>

        <!-- HOW TO USE SECTION -->
        <div id="howto" class="section active">
            <h2>üìñ How to Use This Tracker</h2>
            
            <div class="alert">
                <strong>üéØ Core Principle:</strong> You're learning through FEELING, not thinking. This tracker helps you stay systematic, track patterns, and build new neural pathways through repetition and clear messaging.
            </div>

            <h3>üåÖ Every Morning (5 minutes)</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #27ae60;">
                <ol style="line-height: 2;">
                    <li><strong>Open the Daily Practice section</strong></li>
                    <li><strong>Check today's date is set</strong> (should auto-fill)</li>
                    <li><strong>Choose ONE primary focus</strong> - Don't try to fix everything!
                        <ul style="margin-top: 10px;">
                            <li>Throat grab at turnaround</li>
                            <li>Meerkat/elevation</li>
                            <li>Passive release</li>
                            <li>Arm independence</li>
                        </ul>
                    </li>
                    <li><strong>Write your one-sentence intention</strong>
                        <ul style="margin-top: 10px;">
                            <li>Example: "Today I'm eliminating throat grab at the turnaround"</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <h3>üß† During Practice Session (30-45 min)</h3>
            <div style="background: #fff9e6; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
                
                <h4 style="color: #e67e22;">Left-Brain Block #1 (15 min) - EYES CLOSED WORK</h4>
                <ol style="line-height: 2;">
                    <li><strong>Fill in "What am I working on"</strong> - Your ONE focus for today</li>
                    <li><strong>Step 1 - Intention:</strong> What do you want to achieve?
                        <ul><li>Example: "I want throat to stay open through the turnaround"</li></ul>
                    </li>
                    <li><strong>Step 2 - Call Out the Error:</strong> What's the possible error?
                        <ul><li>Example: "Throat/back of tongue locks at top of breath"</li></ul>
                    </li>
                    <li><strong>Step 3 - The Drill:</strong> What's the opposing feeling?
                        <ul><li>Example: "Finger between teeth - breathe to top - turnaround - throat STAYS open - passive drop"</li></ul>
                    </li>
                    <li><strong>Step 4 - Messaging:</strong> Create your mantra
                        <ul><li>Example: "Next time I reach the top of breath, I will keep throat open like the drill"</li></ul>
                    </li>
                    <li><strong>NOW DO THE DRILL:</strong>
                        <ul style="margin-top: 10px;">
                            <li><strong>EYES CLOSED</strong> for most reps</li>
                            <li>Spotlight on the area (throat, belly, etc.)</li>
                            <li>After each rep: Did I get what I want?</li>
                            <li>YES ‚Üí Repeat (green loop)</li>
                            <li>NO ‚Üí Back to Step 1 (diagnostic)</li>
                        </ul>
                    </li>
                    <li><strong>Track your reps</strong> - How many did you do?</li>
                    <li><strong>Success ratio</strong> - How many were correct? (e.g., 7/10)</li>
                    <li><strong>Notes</strong> - Any observations or breakthroughs</li>
                </ol>

                <h4 style="color: #e67e22; margin-top: 25px;">Right-Brain Block #1 (15 min) - JUST PLAY</h4>
                <ol style="line-height: 2;">
                    <li><strong>Put the process aside</strong> - Time to make music</li>
                    <li><strong>Play scales, tunes, exercises</strong> - Whatever you want</li>
                    <li><strong>OBSERVE ONLY</strong> - Don't fix errors during this block
                        <ul style="margin-top: 10px;">
                            <li>Did the error from left-brain appear?</li>
                            <li>When did it happen?</li>
                            <li>What triggered it?</li>
                        </ul>
                    </li>
                    <li><strong>Note what felt good</strong> - These are wins to celebrate!</li>
                    <li><strong>Log it in the form</strong></li>
                </ol>

                <p style="margin-top: 20px; padding: 15px; background: white; border-radius: 5px; border: 2px solid #e67e22;">
                    <strong>üí° Key Insight:</strong> The right-brain block is your REALITY CHECK. It tells you whether the left-brain work is transferring. If the error still happens, that's OK - it means you need more left-brain drilling. This is the assessment phase.
                </p>
            </div>

            <h3>‚òÄÔ∏è Throughout the Day - The 16-8 Process</h3>
            <div style="background: #e8f4f8; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #3498db;">
                <p><strong>Goal: 64 reps spread throughout your waking hours (16 hours awake √∑ 8 = every 15 minutes)</strong></p>
                
                <h4>How to use the Quick Tally (at top of page):</h4>
                <ol style="line-height: 2;">
                    <li><strong>Select your drill</strong> from the dropdown (should match what you're working on)</li>
                    <li><strong>Write your message</strong> (your mantra for the day)</li>
                    <li><strong>Set a timer or reminder</strong> for every 15-20 minutes</li>
                    <li><strong>When the reminder goes off:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Stop what you're doing (10 seconds only)</li>
                            <li>Do your quick drill (e.g., finger between teeth, feel openness)</li>
                            <li>Say your message mentally ("Playing feels like THIS")</li>
                            <li>Click one square in the tally</li>
                            <li>Continue with your day</li>
                        </ul>
                    </li>
                </ol>

                <p style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px;">
                    <strong>üß† Why this works:</strong> You're showing your brain the correct feeling 64 times. Combined with your message, this builds new neural pathways OVERNIGHT. Tomorrow when you practice, your brain has already been primed.
                </p>
            </div>

            <h3>üåô End of Session (5 minutes)</h3>
            <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #34495e;">
                <ol style="line-height: 2;">
                    <li><strong>Scroll to "End of Session Review"</strong> in Daily Practice</li>
                    <li><strong>Describe the main error</strong> you experienced</li>
                    <li><strong>How it FELT</strong> (be specific - this is crucial)</li>
                    <li><strong>The drill that fixes it</strong></li>
                    <li><strong>The correct feeling</strong> (what you want instead)</li>
                    <li><strong>Next session's message</strong> to your brain</li>
                    <li><strong>Click "Save This Session"</strong></li>
                </ol>

                <p style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px;">
                    <strong>Before bed:</strong> Mentally review the correct feeling one more time. Your brain consolidates learning during sleep - give it the right information to work with!
                </p>
            </div>

            <h3>üìÖ Weekly (Sunday evening, 15 minutes)</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9b59b6;">
                <ol style="line-height: 2;">
                    <li><strong>Go to Weekly Review section</strong></li>
                    <li><strong>Set the week date</strong> (Monday of that week)</li>
                    <li><strong>What was your main issue?</strong> (The ONE thing you focused on)</li>
                    <li><strong>Fill in the daily tracking table:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Check boxes for intention/error/drill each day</li>
                            <li>Add success rates</li>
                            <li>Quick notes</li>
                        </ul>
                    </li>
                    <li><strong>Choose your progress level</strong> (worse ‚Üí eliminated)</li>
                    <li><strong>Update the "I Know" sliders:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Drag each slider to show where you are</li>
                            <li>Left = Unaware/struggling</li>
                            <li>Right = "I know" (locked in, automatic)</li>
                        </ul>
                    </li>
                    <li><strong>Write reflections</strong> - What worked? What didn't?</li>
                    <li><strong>Save it!</strong></li>
                </ol>

                <p style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px;">
                    <strong>üìä Decision time:</strong> If your slider moved right AND success rate improved ‚Üí Move to next issue. If not ‚Üí Continue with same issue next week. Don't move on too early!
                </p>
            </div>

            <h3>üéØ When You Discover a New Error</h3>
            <div style="background: #fff5f5; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #e74c3c;">
                <p><strong>This is GOOD NEWS!</strong> You can only fix what you can detect. Awareness is half the solution.</p>
                
                <ol style="line-height: 2;">
                    <li><strong>Go to Error Trilogy section</strong></li>
                    <li><strong>Name the error</strong> clearly</li>
                    <li><strong>Detection:</strong>
                        <ul style="margin-top: 10px;">
                            <li>How do you know it's happening? (feel/see/hear)</li>
                            <li>When does it happen?</li>
                            <li>Where in the body?</li>
                        </ul>
                    </li>
                    <li><strong>Rejection:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Why must it go?</li>
                            <li>How urgent? (1-10)</li>
                            <li>Your zero tolerance statement</li>
                        </ul>
                    </li>
                    <li><strong>Correction:</strong>
                        <ul style="margin-top: 10px;">
                            <li>What drill creates the opposite feeling?</li>
                            <li>What's the correct feeling?</li>
                            <li>Your message</li>
                            <li>Daily rep target (suggest 64)</li>
                        </ul>
                    </li>
                    <li><strong>Save it</strong></li>
                    <li><strong>Make this your primary focus</strong> for upcoming practice</li>
                </ol>
            </div>

            <h3>üìä Tracking Progress</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                <ul style="line-height: 2;">
                    <li><strong>Check Progress & Stats regularly</strong> to see your streak and total sessions</li>
                    <li><strong>Log "Felt Like Doing Nothing" moments</strong> - These are huge wins!</li>
                    <li><strong>Watch your practice streak</strong> - Consistency builds habits</li>
                    <li><strong>Review recent sessions</strong> to spot patterns</li>
                </ul>
            </div>

            <h3>üíæ Don't Forget to Backup!</h3>
            <div class="alert warning">
                <strong>‚ö†Ô∏è Important:</strong> Your data is stored in your browser. Go to Export/Import section monthly and download a backup file. If you clear browser data or switch devices, you'll lose everything unless you have a backup!
            </div>

            <h3>üöÄ Quick Start Checklist</h3>
            <div style="background: #d4edda; padding: 20px; border-radius: 8px; margin: 15px 0; border: 2px solid #27ae60;">
                <h4 style="margin-top: 0;">First Time Using This Tracker?</h4>
                <ol style="line-height: 2;">
                    <li>‚úÖ Read this How To Use section completely</li>
                    <li>‚úÖ Go to Error Trilogy and log your current main error</li>
                    <li>‚úÖ Set up Quick Tally with today's drill and message</li>
                    <li>‚úÖ Do a practice session and log it in Daily Practice</li>
                    <li>‚úÖ Set a phone reminder for every 15 minutes (for 16-8 process)</li>
                    <li>‚úÖ Export a backup (just in case!)</li>
                    <li>‚úÖ Read the Quick Reference section for the core concepts</li>
                </ol>
            </div>

            <div style="background: #3498db; color: white; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: center;">
                <h3 style="margin: 0 0 15px 0; color: white;">üé∫ Remember: You're Changing Your Brain</h3>
                <p style="font-size: 1.1em; line-height: 1.8; margin: 0;">
                    This isn't just practice tracking - it's <strong>neuroplasticity in action</strong>.<br>
                    Every rep with clear intention builds new pathways.<br>
                    Every message tells your subconscious what you want.<br>
                    Every error detected is a step toward "I Know".<br>
                    <br>
                    <strong>Be patient. Be consistent. Trust the process.</strong>
                </p>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button onclick="showSection('daily')" style="font-size: 1.1em; padding: 15px 30px;">
                    Let's Start ‚Üí Daily Practice
                </button>
            </div>
        </div>

        <!-- DAILY PRACTICE SECTION -->
        <div id="daily" class="section active">
            <h2>Daily Practice Log</h2>
            
            <div class="form-group">
                <label for="practice-date">Date:</label>
                <input type="date" id="practice-date" onchange="autoSaveDraft()">
            </div>

            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f39c12;">
                <p style="margin: 0;"><strong>üíæ Auto-Save Active:</strong> Your work is automatically saved as you type. Safe to switch apps!</p>
            </div>

            <h3>Morning Check-In</h3>

            <!-- HELP: Morning Check-In -->
            <div class="help-toggle" onclick="toggleHelp('help-morning')">
                <h4><span class="arrow">‚ñ∂</span> üìñ How to do Morning Check-In</h4>
            </div>
            <div id="help-morning" class="help-content">
                <p><strong>Purpose:</strong> Set your intention for the day. Pick ONE focus - don't try to fix everything at once.</p>
                <ol>
                    <li><strong>Choose your primary focus</strong> - What's the main error you're working on?</li>
                    <li><strong>Write one clear sentence</strong> - "Today I'm eliminating [specific error]"</li>
                </ol>
                <div class="help-tip">
                    <strong>Remember:</strong> You can't work on 4 things at once. Pick the most urgent error from your Error Trilogy. Once it's "locked in," move to the next one.
                </div>
            </div>

            <div class="form-group">
                <label>Today's Primary Focus:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="focus-throat" value="throat" onchange="autoSaveDraft()">
                    <label for="focus-throat">Throat grab at turnaround</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="focus-meerkat" value="meerkat" onchange="autoSaveDraft()">
                    <label for="focus-meerkat">Meerkat/elevation</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="focus-passive" value="passive" onchange="autoSaveDraft()">
                    <label for="focus-passive">Passive release</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="focus-arms" value="arms" onchange="autoSaveDraft()">
                    <label for="focus-arms">Arm independence</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="focus-other" value="other" onchange="autoSaveDraft()">
                    <label for="focus-other">Other</label>
                    <input type="text" id="focus-other-text" placeholder="Specify..." style="width: 200px; margin-left: 10px;" oninput="autoSaveDraft()">
                </div>
            </div>

            <div class="form-group">
                <label for="daily-intention">One Sentence Intention:</label>
                <input type="text" id="daily-intention" placeholder="Today I'm working on..." oninput="autoSaveDraft()">
            </div>

            <h3>Left-Brain Block #1 (15 min) - Eyes Closed Work</h3>

            <!-- HELP: Left-Brain Block -->
            <div class="help-toggle" onclick="toggleHelp('help-leftbrain')">
                <h4><span class="arrow">‚ñ∂</span> üìñ How to do Left-Brain Practice</h4>
            </div>
            <div id="help-leftbrain" class="help-content">
                <p><strong>Purpose:</strong> Systematic error correction through feeling-based drills. This is where you CHANGE YOUR BRAIN.</p>
                
                <p><strong>The 6-Step Process:</strong></p>
                <ol>
                    <li><strong>What am I working on?</strong> - State your ONE focus clearly</li>
                    <li><strong>Step 1 - Intention:</strong> What do you want to achieve?
                        <ul><li>Example: "I want throat to stay open through the turnaround"</li></ul>
                    </li>
                    <li><strong>Step 2 - Call Out the Error:</strong> What's the possible error?
                        <ul><li>Example: "Throat/back of tongue locks at top of breath"</li></ul>
                    </li>
                    <li><strong>Step 3 - The Drill:</strong> What creates the opposite feeling?
                        <ul><li>Example: "Finger between teeth - breathe to top - turnaround - throat STAYS open - passive drop"</li></ul>
                    </li>
                    <li><strong>Step 4 - Messaging:</strong> Create your mantra
                        <ul><li>Example: "Next time I reach the top of breath, I will keep throat open like the drill"</li></ul>
                    </li>
                    <li><strong>Step 5 - Execute:</strong> DO THE DRILL
                        <ul>
                            <li><strong>EYES CLOSED</strong> for most reps</li>
                            <li>Spotlight on the target area (throat, belly, etc.)</li>
                            <li>After each rep: "Did I get what I want?"</li>
                            <li>YES ‚Üí Repeat (green loop) - build the mile-and-mile</li>
                            <li>NO ‚Üí Back to Step 1 (diagnostic) - why did it fail?</li>
                        </ul>
                    </li>
                </ol>

                <div class="help-tip">
                    <strong>Critical:</strong> This is NOT random practice. Each rep has CLEAR INTENTION. You're showing your brain: "This is the feeling I want." The brain learns from repetition + clear messaging.
                </div>

                <p><strong>How to track:</strong></p>
                <ul>
                    <li><strong>Reps:</strong> How many times did you do the drill?</li>
                    <li><strong>Success Ratio:</strong> How many were correct? (e.g., 7/10 means 7 good, 3 had the error)</li>
                    <li><strong>Notes:</strong> Any observations, breakthroughs, or patterns</li>
                </ul>

                <div class="help-tip">
                    <strong>When to stop:</strong> When you get 8-10 correct reps in a row, you've built enough for today. Don't drill to exhaustion - your brain consolidates this overnight.
                </div>
            </div>

            <div class="form-group">
                <label for="lb1-working-on">What am I working on:</label>
                <input type="text" id="lb1-working-on" placeholder="e.g., Eliminating throat grab at turnaround" oninput="autoSaveDraft()">
            </div>

            <div class="form-group">
                <label for="lb1-intention">Step 1 - Intention of Success:</label>
                <textarea id="lb1-intention" placeholder="What do I want to achieve?" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="lb1-error">Step 2 - Call Out the Error:</label>
                <textarea id="lb1-error" placeholder="What's the possible error?" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="lb1-drill">Step 3 - The Drill:</label>
                <textarea id="lb1-drill" placeholder="What's the opposing feeling drill?" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="lb1-message">Step 4 - Messaging:</label>
                <input type="text" id="lb1-message" placeholder="Next time I _____, I will feel _____" oninput="autoSaveDraft()">
            </div>

            <div class="form-group">
                <label for="lb1-reps">Reps Completed:</label>
                <input type="number" id="lb1-reps" min="0" value="0" oninput="autoSaveDraft()">
            </div>

            <div class="form-group">
                <label for="lb1-success">Success Ratio (e.g., 7/10):</label>
                <input type="text" id="lb1-success" placeholder="7/10" oninput="autoSaveDraft()">
            </div>

            <div class="form-group">
                <label for="lb1-notes">Notes:</label>
                <textarea id="lb1-notes" placeholder="Any observations..." oninput="autoSaveDraft()"></textarea>
            </div>

            <h3>Right-Brain Block #1 (15 min) - Just Play</h3>

            <!-- HELP: Right-Brain Block -->
            <div class="help-toggle" onclick="toggleHelp('help-rightbrain')">
                <h4><span class="arrow">‚ñ∂</span> üìñ How to do Right-Brain Practice</h4>
            </div>
            <div id="help-rightbrain" class="help-content">
                <p><strong>Purpose:</strong> This is your REALITY CHECK. Does the left-brain work transfer to actual playing?</p>
                
                <p><strong>What to do:</strong></p>
                <ol>
                    <li><strong>Put the process aside</strong> - No thinking about technique</li>
                    <li><strong>Play music</strong> - Scales, tunes, exercises, whatever you want</li>
                    <li><strong>OBSERVE ONLY</strong> - This is key!
                        <ul>
                            <li>Did the error from left-brain appear?</li>
                            <li>When did it happen?</li>
                            <li>What triggered it?</li>
                        </ul>
                    </li>
                    <li><strong>Don't fix during this block</strong> - Just notice and log it</li>
                    <li><strong>Note what felt good</strong> - These are wins!</li>
                </ol>

                <div class="help-tip">
                    <strong>The Formula 1 Principle:</strong> The racing driver doesn't fix the car halfway through the race. He sends a message back to the mechanics: "When I get back, fix this." You're the driver now. Notice the issues, log them, and fix them in the next left-brain block.
                </div>

                <p><strong>What the results mean:</strong></p>
                <ul>
                    <li><strong>Error still happening often:</strong> Good! You're aware of it. Need more left-brain drilling.</li>
                    <li><strong>Error happening less:</strong> Great! The drill is working. Keep going.</li>
                    <li><strong>Error almost gone:</strong> Excellent! You're approaching "I Know" territory.</li>
                    <li><strong>Felt effortless:</strong> LOG THIS! Go to Progress & Stats ‚Üí Effortless Moments</li>
                </ul>

                <div class="help-tip">
                    <strong>Remember:</strong> Right-brain practice is NOT wasted time. It's essential assessment. Without this, you don't know if your left-brain work is effective.
                </div>
            </div>

            <div class="form-group">
                <label for="rb1-played">What I Played:</label>
                <input type="text" id="rb1-played" placeholder="Scales, tunes, exercises..." oninput="autoSaveDraft()">
            </div>

            <div class="form-group">
                <label for="rb1-errors">Errors I Noticed (observe only):</label>
                <textarea id="rb1-errors" placeholder="Don't fix, just notice..." oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="rb1-good">What Felt Good:</label>
                <textarea id="rb1-good" placeholder="Moments of ease..." oninput="autoSaveDraft()"></textarea>
            </div>

            <h3>End of Session Review</h3>

            <!-- HELP: End of Session -->
            <div class="help-toggle" onclick="toggleHelp('help-endofsession')">
                <h4><span class="arrow">‚ñ∂</span> üìñ How to do End of Session Review</h4>
            </div>
            <div id="help-endofsession" class="help-content">
                <p><strong>Purpose:</strong> Consolidate this session's learning and prime your brain for processing.</p>
                
                <p><strong>The process:</strong></p>
                <ol>
                    <li><strong>Main error today:</strong> What error appeared most often?</li>
                    <li><strong>How it FELT:</strong> Be specific - "Tight in throat" not just "bad"
                        <ul><li>The brain learns from feelings, not descriptions</li></ul>
                    </li>
                    <li><strong>The opposing drill:</strong> What drill creates the opposite feeling?</li>
                    <li><strong>The correct feeling:</strong> What do you want instead?</li>
                    <li><strong>Tomorrow's message:</strong> What will you tell your brain next session?
                        <ul><li>Example: "When I reach top of breath, throat stays open"</li></ul>
                    </li>
                </ol>

                <div class="help-tip">
                    <strong>Before bed tonight:</strong> Mentally review the correct feeling one more time. Your brain builds new neural pathways during sleep. Give it the right blueprint to work with!
                </div>

                <p><strong>Why this matters:</strong></p>
                <ul>
                    <li>You're feeding your subconscious the learning points</li>
                    <li>Brain consolidates during sleep (the mile-and-mile coating)</li>
                    <li>Tomorrow morning you'll wake up with slightly different wiring</li>
                    <li>This is THE SCIENCE of neuroplasticity in action</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="eod-error">Error I experienced this session:</label>
                <textarea id="eod-error" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="eod-feeling">How it felt (be specific):</label>
                <textarea id="eod-feeling" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="eod-drill">The opposing drill that fixes it:</label>
                <textarea id="eod-drill" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="eod-correct">The correct feeling:</label>
                <textarea id="eod-correct" oninput="autoSaveDraft()"></textarea>
            </div>

            <div class="form-group">
                <label for="eod-tomorrow">Next session's message to my brain:</label>
                <input type="text" id="eod-tomorrow" placeholder="When I _____, I will _____" oninput="autoSaveDraft()">
            </div>

            <button onclick="saveDailySession()">üíæ Save This Session</button>
            <button class="secondary" onclick="clearDailyForm()">Clear Form for New Session</button>

            <div id="save-alert" style="display: none;" class="alert">Session saved! You can log another session today if you practice again.</div>

            <h3>Today's Sessions</h3>
            <div id="todays-sessions" class="session-list"></div>

            <h3>Recent Sessions (Last 10)</h3>
            <div id="recent-sessions" class="session-list"></div>
        </div>

        <!-- WEEKLY REVIEW SECTION -->
        <div id="weekly" class="section">
            <h2>Weekly Review</h2>
            
            <div class="form-group">
                <label for="week-of">Week of:</label>
                <input type="date" id="week-of">
            </div>

            <div class="form-group">
                <label for="week-main-issue">Main Issue This Week:</label>
                <input type="text" id="week-main-issue" placeholder="e.g., Throat grab at turnaround">
            </div>

            <h3>Daily Tracking</h3>
            <table>
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Intention Clear?</th>
                        <th>Error Identified?</th>
                        <th>Drill Done?</th>
                        <th>Success Rate</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="weekly-table">
                    <tr data-day="Monday">
                        <td>Monday</td>
                        <td><input type="checkbox" class="week-check" data-day="mon" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="mon" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="mon" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="mon" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="mon" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Tuesday">
                        <td>Tuesday</td>
                        <td><input type="checkbox" class="week-check" data-day="tue" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="tue" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="tue" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="tue" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="tue" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Wednesday">
                        <td>Wednesday</td>
                        <td><input type="checkbox" class="week-check" data-day="wed" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="wed" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="wed" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="wed" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="wed" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Thursday">
                        <td>Thursday</td>
                        <td><input type="checkbox" class="week-check" data-day="thu" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="thu" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="thu" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="thu" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="thu" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Friday">
                        <td>Friday</td>
                        <td><input type="checkbox" class="week-check" data-day="fri" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="fri" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="fri" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="fri" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="fri" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Saturday">
                        <td>Saturday</td>
                        <td><input type="checkbox" class="week-check" data-day="sat" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="sat" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="sat" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="sat" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="sat" placeholder="Notes..."></td>
                    </tr>
                    <tr data-day="Sunday">
                        <td>Sunday</td>
                        <td><input type="checkbox" class="week-check" data-day="sun" data-field="intention"></td>
                        <td><input type="checkbox" class="week-check" data-day="sun" data-field="error"></td>
                        <td><input type="checkbox" class="week-check" data-day="sun" data-field="drill"></td>
                        <td><input type="text" class="week-success" data-day="sun" placeholder="7/10" style="width: 60px;"></td>
                        <td><input type="text" class="week-notes" data-day="sun" placeholder="Notes..."></td>
                    </tr>
                </tbody>
            </table>

            <div class="form-group">
                <label>Progress This Week:</label>
                <div class="checkbox-group">
                    <input type="radio" name="week-progress" id="prog-worse" value="worse">
                    <label for="prog-worse">Error getting worse (noticing it more - GOOD!)</label>
                </div>
                <div class="checkbox-group">
                    <input type="radio" name="week-progress" id="prog-same" value="same">
                    <label for="prog-same">Error same (keep drilling)</label>
                </div>
                <div class="checkbox-group">
                    <input type="radio" name="week-progress" id="prog-improving" value="improving">
                    <label for="prog-improving">Error improving (drill is working)</label>
                </div>
                <div class="checkbox-group">
                    <input type="radio" name="week-progress" id="prog-almost" value="almost">
                    <label for="prog-almost">Error almost gone (approaching "I know" token)</label>
                </div>
                <div class="checkbox-group">
                    <input type="radio" name="week-progress" id="prog-eliminated" value="eliminated">
                    <label for="prog-eliminated">Error eliminated (locked in! Move to next issue)</label>
                </div>
            </div>

            <h3>The "I Know" Sliders</h3>
            <div id="sliders-container"></div>

            <div class="form-group">
                <label for="week-reflections">Week Reflections:</label>
                <textarea id="week-reflections" placeholder="What I learned, what worked, what didn't..."></textarea>
            </div>

            <button onclick="saveWeeklyReview()">üíæ Save Weekly Review</button>
            <button class="secondary" onclick="clearWeeklyForm()">Clear Form</button>

            <h3>Past Weekly Reviews</h3>
            <div id="past-weeks" class="session-list"></div>
        </div>

        <!-- LESSONS LOG SECTION -->
        <div id="lessons" class="section">
            <h2>üéì Lessons Log</h2>
            <p style="color: #7f8c8d; margin-bottom: 20px;">Keep track of lessons with your teacher and extract the key learning points</p>

            <div class="help-toggle" onclick="toggleHelp('help-lessons')">
                <h4><span class="arrow">‚ñ∂</span> üìñ How to Use Lessons Log</h4>
            </div>
            <div id="help-lessons" class="help-content">
                <p><strong>Purpose:</strong> Distill each lesson into actionable steps and key discoveries.</p>
                
                <p><strong>After each lesson:</strong></p>
                <ol>
                    <li><strong>Fill this out within 24 hours</strong> while it's fresh</li>
                    <li><strong>Watch the lesson video</strong> (if you have one) and take notes</li>
                    <li><strong>Extract the essential points</strong> - not everything, just what matters</li>
                    <li><strong>Identify your homework</strong> - what to work on next</li>
                    <li><strong>Add to Error Trilogy</strong> - any new errors discovered</li>
                </ol>

                <div class="help-tip">
                    <strong>The goal:</strong> Compress a 60-minute lesson into 5 minutes of reading that tells you exactly what to do.
                </div>
            </div>

            <h3>Add New Lesson</h3>

            <div class="form-group">
                <label for="lesson-date">Lesson Date:</label>
                <input type="date" id="lesson-date">
            </div>

            <div class="form-group">
                <label for="lesson-teacher">Teacher:</label>
                <input type="text" id="lesson-teacher" placeholder="Teacher's name">
            </div>

            <div class="form-group">
                <label for="lesson-number">Lesson # (optional):</label>
                <input type="number" id="lesson-number" min="1" placeholder="e.g., 3">
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üìå Key Discoveries</h4>
            <p style="color: #7f8c8d; margin-bottom: 10px;">What were the main issues identified in this lesson?</p>

            <div class="form-group">
                <label for="lesson-discoveries">Main Issues/Errors Found:</label>
                <textarea id="lesson-discoveries" placeholder="e.g., 
‚Ä¢ Throat grab at turnaround
‚Ä¢ Meerkat/elevation when breathing
‚Ä¢ Arm recruitment causing chest tension
..."></textarea>
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üîß Specific Process/Drills</h4>
            <p style="color: #7f8c8d; margin-bottom: 10px;">What is your EXACT process to fix these issues?</p>

            <div class="form-group">
                <label for="lesson-process">Step-by-Step Process:</label>
                <textarea id="lesson-process" placeholder="For each main issue, what's the drill?

Example:
ISSUE: Throat grab at turnaround
DRILL: 
1. Finger between teeth
2. Breathe in - feel expansion
3. At top - don't grab, stay open
4. Passive drop/reduction
5. Message: 'This is what playing feels like'
..."></textarea>
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üí° Key Insights/Breakthroughs</h4>
            <p style="color: #7f8c8d; margin-bottom: 10px;">What clicked? What made sense?</p>

            <div class="form-group">
                <label for="lesson-insights">Aha Moments:</label>
                <textarea id="lesson-insights" placeholder="e.g.,
‚Ä¢ The 'turnaround' concept - breath changes direction at top, like rollercoaster
‚Ä¢ Meerkat - I'm lifting my whole torso, not just ribs
‚Ä¢ Arms recruiting chest - need to move elbows independently
‚Ä¢ The 168 process - 64 reps throughout day builds pathways overnight
..."></textarea>
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üìã Your Homework</h4>
            <p style="color: #7f8c8d; margin-bottom: 10px;">What specific things should you work on before next lesson?</p>

            <div class="form-group">
                <label for="lesson-homework">Action Items:</label>
                <textarea id="lesson-homework" placeholder="e.g.,
1. Master the turnaround drill - 100% consistent no-grab
2. Video yourself - watch for meerkat
3. 80% eyes-closed practice this week
4. Set phone reminder for 168 process (every 15 min)
5. Add 'throat grab' to Error Trilogy
..."></textarea>
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">‚ö†Ô∏è What NOT to Do</h4>
            <p style="color: #7f8c8d; margin-bottom: 10px;">Common mistakes or things to avoid</p>

            <div class="form-group">
                <label for="lesson-avoid">Avoid These:</label>
                <textarea id="lesson-avoid" placeholder="e.g.,
‚ùå Don't try to recreate feeling without the process
‚ùå Don't accept 'close enough' on throat engagement
‚ùå Don't practice without clear intention
‚ùå Don't skip eyes-closed work
..."></textarea>
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üéØ Primary Focus for Next Week</h4>
            
            <div class="form-group">
                <label for="lesson-focus">One Main Thing to Work On:</label>
                <input type="text" id="lesson-focus" placeholder="e.g., Eliminate throat grab at turnaround">
            </div>

            <h4 style="color: #e67e22; margin-top: 25px;">üìù Additional Notes</h4>

            <div class="form-group">
                <label for="lesson-notes">General Notes/Observations:</label>
                <textarea id="lesson-notes" placeholder="Any other important points, questions to ask next time, etc."></textarea>
            </div>

            <div class="form-group">
                <label for="lesson-video">Video Link (optional):</label>
                <input type="text" id="lesson-video" placeholder="e.g., YouTube unlisted link, Dropbox link, etc.">
            </div>

            <button onclick="saveLesson()">üíæ Save Lesson</button>
            <button class="secondary" onclick="clearLessonForm()">Clear Form</button>

            <div id="lesson-save-alert" style="display: none;" class="alert">Lesson saved!</div>

            <h3 style="margin-top: 40px;">Past Lessons</h3>
            <div id="lessons-list"></div>
        </div>

        <!-- ERROR TRILOGY SECTION -->
        <div id="errors" class="section">
            <h2>Error Trilogy</h2>
            <p style="margin-bottom: 20px; color: #7f8c8d;">Use this template for ANY error you discover</p>

            <h3>Error Detection</h3>
            <div class="form-group">
                <label for="error-name">The error is:</label>
                <input type="text" id="error-name" placeholder="e.g., Throat grab at turnaround">
            </div>

            <div class="form-group">
                <label>How I detect it:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="detect-feel" value="feel">
                    <label for="detect-feel">I can feel it</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="detect-see" value="see">
                    <label for="detect-see">I can see it (mirror/video)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="detect-hear" value="hear">
                    <label for="detect-hear">I can hear it (in sound)</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="detect-told" value="told">
                    <label for="detect-told">Someone pointed it out</label>
                </div>
            </div>

            <div class="form-group">
                <label for="error-when">When does it happen:</label>
                <textarea id="error-when" placeholder="During specific exercises, at certain times..."></textarea>
            </div>

            <div class="form-group">
                <label for="error-where">Where in the body:</label>
                <textarea id="error-where" placeholder="Throat, chest, abdomen..."></textarea>
            </div>

            <h3>Error Rejection</h3>
            <div class="form-group">
                <label for="error-why">This error must go because:</label>
                <textarea id="error-why" placeholder="Why is this important to fix..."></textarea>
            </div>

            <div class="form-group">
                <label for="error-urgency">My level of urgency (1-10):</label>
                <input type="range" id="error-urgency" min="1" max="10" value="5" 
                       oninput="document.getElementById('urgency-value').textContent = this.value">
                <span id="urgency-value">5</span>
            </div>

            <div class="form-group">
                <label for="error-statement">Zero tolerance statement:</label>
                <input type="text" id="error-statement" placeholder="I refuse to _____ anymore because _____">
            </div>

            <h3>Error Correction</h3>
            <div class="form-group">
                <label for="error-drill">The opposing drill:</label>
                <textarea id="error-drill" placeholder="What drill creates the opposite feeling..."></textarea>
            </div>

            <div class="form-group">
                <label for="error-correct-feel">The correct feeling:</label>
                <textarea id="error-correct-feel" placeholder="What should it feel like..."></textarea>
            </div>

            <div class="form-group">
                <label for="error-message">The message:</label>
                <input type="text" id="error-message" placeholder="When I _____, I will feel _____">
            </div>

            <div class="form-group">
                <label for="error-reps">Daily rep target:</label>
                <input type="number" id="error-reps" min="1" value="64">
            </div>

            <button onclick="saveErrorTrilogy()">üíæ Save Error Trilogy</button>
            <button class="secondary" onclick="clearErrorForm()">Clear Form</button>

            <h3>Your Error Log</h3>
            <div id="error-log"></div>
        </div>

        <!-- PROGRESS & STATS SECTION -->
        <div id="progress" class="section">
            <h2>Progress & Statistics</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Sessions</div>
                    <div class="stat-number" id="stat-sessions">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Current Streak</div>
                    <div class="stat-number" id="stat-streak">0</div>
                    <div class="stat-label">days</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Practice Time</div>
                    <div class="stat-number" id="stat-time">0</div>
                    <div class="stat-label">minutes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Errors Tracked</div>
                    <div class="stat-number" id="stat-errors">0</div>
                </div>
            </div>

            <h3>Practice Frequency (Last 30 Days)</h3>
            <div id="practice-calendar"></div>

            <h3>Error Progress Over Time</h3>
            <div id="error-progress-chart"></div>

            <h3>"Felt Like Doing Nothing" Moments</h3>
            <div class="form-group">
                <label for="effortless-date">Date:</label>
                <input type="date" id="effortless-date">
            </div>
            <div class="form-group">
                <label for="effortless-activity">What I was doing:</label>
                <input type="text" id="effortless-activity" placeholder="Playing low C, scales, etc.">
            </div>
            <button onclick="saveEffortlessMoment()">‚ú® Save Effortless Moment</button>

            <div id="effortless-log"></div>
        </div>

        <!-- QUICK REFERENCE SECTION -->
        <div id="reference" class="section">
            <h2>Quick Reference Cards</h2>

            <div class="quick-ref-cards">
                <div class="ref-card">
                    <h4>The Learning Loop</h4>
                    <pre>1. INTENTION ‚Üí What am I working on?
2. ERROR ‚Üí What could go wrong?
3. DRILL ‚Üí Opposing feeling
4. MESSAGE ‚Üí "Next time, do THIS"
5. EXECUTE ‚Üí No RAM, just do it
6. LOOP ‚Üí Good? Repeat. Bad? Back to #1</pre>
                </div>

                <div class="ref-card">
                    <h4>Every Action Needs a Message</h4>
                    <pre>Breathing? ‚Üí "This is what playing feels like"
Drilling? ‚Üí "This is what I want"
Error? ‚Üí "Not doing that anymore"
Success? ‚Üí "That's it! Again!"</pre>
                </div>

                <div class="ref-card">
                    <h4>Zero Tolerance List</h4>
                    <pre>‚úó Throat grab
‚úó Meerkat/elevation
‚úó Active pushing
‚úó Arm recruitment
‚úó "Close enough"</pre>
                </div>

                <div class="ref-card">
                    <h4>The Feeling Triangle</h4>
                    <pre>      VISUALIZATION
       (What I want)
            /\
           /  \
          /    \
         /      \
        /        \
  FEELING ---- MESSAGE
(Eyes closed)  (To brain)</pre>
                </div>

                <div class="ref-card">
                    <h4>The 168 Process</h4>
                    <pre>16 hours awake √ó 4 reps/hour = 64 daily reps

Every 15 minutes:
‚Ä¢ Quick drill (10 seconds)
‚Ä¢ Feel the correct sensation
‚Ä¢ Message: "Playing feels like THIS"
‚Ä¢ Continue with day

Brain builds new pathways overnight</pre>
                </div>

                <div class="ref-card">
                    <h4>Error Detection Signs</h4>
                    <pre>‚Ä¢ Throat grab/lock
‚Ä¢ Meerkat (elevation)
‚Ä¢ Synchronized reduction
‚Ä¢ Active pushing
‚Ä¢ Jaw activation
‚Ä¢ Arm recruitment
‚Ä¢ Chest coning
‚Ä¢ Any involuntary tension</pre>
                </div>
            </div>

            <h3>Common Errors & Fixes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Error</th>
                        <th>How to Detect</th>
                        <th>Opposing Drill</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Throat grab at turnaround</td>
                        <td>Feel lock at top of breath</td>
                        <td>Finger drill - stay open through turnaround</td>
                        <td>"Turnaround ‚â† grab"</td>
                    </tr>
                    <tr>
                        <td>Meerkat (elevation)</td>
                        <td>Watch yourself - body lifts</td>
                        <td>Breath with spotlight on spine/shoulders</td>
                        <td>"Only ribs move"</td>
                    </tr>
                    <tr>
                        <td>Active release</td>
                        <td>Air feels pushed</td>
                        <td>Balloon deflation - zero effort</td>
                        <td>"Don't help it, don't hold it"</td>
                    </tr>
                    <tr>
                        <td>Elbow recruitment</td>
                        <td>Chest/shoulders tense when arms lift</td>
                        <td>Elbows only - everything else dead weight</td>
                        <td>"Arms are separate"</td>
                    </tr>
                    <tr>
                        <td>Player mode activation</td>
                        <td>Everything tenses when horn comes up</td>
                        <td>Perfect drill ‚Üí add horn ‚Üí check feeling</td>
                        <td>"Horn doesn't change feeling"</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SETTINGS SECTION -->
        <div id="settings" class="section">
            <h2>‚öôÔ∏è Settings</h2>
            
            <h3>GitHub Gist Sync</h3>
            <p style="color: #7f8c8d; margin-bottom: 20px;">Sync your data across all devices using GitHub Gist. Your data is stored in your private GitHub Gist and syncs automatically.</p>
            
            <div id="sync-status" class="alert" style="display: none;">
                <strong id="sync-status-text"></strong>
            </div>

            <div class="form-group">
                <label for="github-token">GitHub Personal Access Token:</label>
                <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" style="font-family: monospace;">
                <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 5px;">
                    Create one at: <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a><br>
                    Only needs <strong>gist</strong> permission. Token is stored locally only.
                </p>
            </div>

            <div class="form-group">
                <label for="gist-id">Gist ID (copy this to use on other devices):</label>
                <input type="text" id="gist-id" placeholder="Will be auto-filled after first sync OR paste from other device" style="font-family: monospace;">
                <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 5px;">
                    <strong>First device:</strong> Leave empty - will auto-fill after first sync<br>
                    <strong>Other devices:</strong> Paste the Gist ID from your first device here before clicking "Pull Latest"
                </p>
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="saveSettingsAndSync()">üíæ Save Settings & Sync Now</button>
                <button class="secondary" onclick="syncFromGist()">‚¨áÔ∏è Pull Latest from GitHub</button>
                <button class="secondary" onclick="syncToGist()">‚¨ÜÔ∏è Push to GitHub</button>
                <button class="secondary" onclick="testConnection()">üîå Test Connection</button>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                <h4 style="margin-top: 0;">‚ÑπÔ∏è How Sync Works</h4>
                <ul style="line-height: 1.8;">
                    <li><strong>Auto-sync:</strong> Every time you save anything, it syncs to GitHub automatically</li>
                    <li><strong>Cross-device:</strong> Use the same token on all devices to keep data in sync</li>
                    <li><strong>Private:</strong> Your Gist is private by default - only you can see it</li>
                    <li><strong>Backup:</strong> Your data is safely stored on GitHub's servers</li>
                    <li><strong>View Gist:</strong> Visit <a href="https://gist.github.com" target="_blank">gist.github.com</a> to see your data</li>
                </ul>
                
                <h4>üîß Already Created Multiple Gists? Here's How to Fix:</h4>
                <ol style="line-height: 1.8;">
                    <li>Go to <a href="https://gist.github.com" target="_blank">gist.github.com</a></li>
                    <li>Find the Gist with the most complete data (probably from iPad)</li>
                    <li>Click on it and copy the ID from the URL (e.g., <code>abc123def456</code>)</li>
                    <li>On your other device (Mac), paste that ID in the "Gist ID" field above</li>
                    <li>Click "Pull Latest from GitHub"</li>
                    <li>Delete the duplicate Gist from gist.github.com (optional cleanup)</li>
                </ol>
                
                <h4>üîê Security</h4>
                <ul style="line-height: 1.8;">
                    <li>Token is stored in your browser's localStorage only</li>
                    <li>Never sent anywhere except GitHub API</li>
                    <li>Revoke token anytime at <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></li>
                    <li>Still export manual backups monthly as insurance</li>
                </ul>

                <h4>üì± Setup on New Device</h4>
                <ol style="line-height: 1.8;">
                    <li>Open this app on new device</li>
                    <li>Go to Settings</li>
                    <li>Paste the same token</li>
                    <li><strong>Paste the Gist ID</strong> (from your first device or from gist.github.com)</li>
                    <li>Click "Pull Latest from GitHub"</li>
                    <li>Done! All your data appears</li>
                </ol>
            </div>

            <h3 style="margin-top: 40px;">Sync Log</h3>
            <div id="sync-log" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.85em; max-height: 200px; overflow-y: auto;">
                No sync activity yet
            </div>
        </div>

        <!-- EXPORT/IMPORT SECTION -->
        <div id="export" class="section">
            <h2>Export & Import Data</h2>

            <div class="export-section">
                <h3>Backup Your Data</h3>
                <p>Download all your practice data as a JSON file. Save this file regularly as a backup.</p>
                <button onclick="exportData()">üì• Download Backup</button>
            </div>

            <div class="export-section">
                <h3>Restore From Backup</h3>
                <p>Upload a previously saved JSON file to restore your data.</p>
                <input type="file" id="import-file" accept=".json">
                <button onclick="importData()">üì§ Upload Backup</button>
            </div>

            <div class="export-section">
                <h3>‚ö†Ô∏è Reset All Data</h3>
                <p class="alert warning">Warning: This will permanently delete all your practice data. Make sure you've downloaded a backup first!</p>
                <button class="danger" onclick="resetAllData()">üóëÔ∏è Reset Everything</button>
            </div>

            <div class="export-section">
                <h3>Print Current View</h3>
                <p>Print the currently visible section for offline reference.</p>
                <button onclick="window.print()">üñ®Ô∏è Print</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize app
        let appData = {
            dailySessions: [],
            weeklyReviews: [],
            errorTrilogies: [],
            effortlessMoments: [],
            lessons: [
                {
                    date: "2025-01-15",
                    teacher: "Your Teacher Name",
                    lessonNumber: 1,
                    discoveries: `‚Ä¢ Throat grab at turnaround - happens when breath changes direction at top
‚Ä¢ Meerkat/elevation - lifting whole torso instead of just ribs expanding
‚Ä¢ Arms recruiting chest - need elbow independence
‚Ä¢ Passive release - three levels: active push ‚Üí gradual control ‚Üí complete passive drop
‚Ä¢ "Felt like doing nothing" = correct feeling`,
                    process: `OLD WAY/NEW WAY METHOD (from Molly Gebrian - "Learn Faster, Perform Better"):

Step 1: COMPARE (Video/Mirror)
‚Ä¢ Watch video of me doing the error vs. the correct way
‚Ä¢ Clearly see and describe the difference
‚Ä¢ Teacher helps identify the visual difference

Step 2: FEEL THE OLD WAY
‚Ä¢ Do the error ON PURPOSE
‚Ä¢ Describe in detail what it FEELS like
‚Ä¢ Close eyes to feel it more clearly
‚Ä¢ Repeat the error several times until I can do it reliably
‚Ä¢ Goal: Bring error into conscious awareness

Step 3: LEARN THE NEW WAY
‚Ä¢ Figure out how to do it correctly (with teacher's help)
‚Ä¢ Describe what the correct way FEELS like
‚Ä¢ Be as concrete and specific as possible

Step 4: ALTERNATE OLD/NEW
‚Ä¢ Do old way ‚Üí describe feeling
‚Ä¢ Do new way ‚Üí describe feeling
‚Ä¢ Repeat 5 times
‚Ä¢ CRITICAL: Verbal descriptions bring habit into conscious awareness

Step 5: DO NEW WAY ONLY
‚Ä¢ 6 repetitions of correct way
‚Ä¢ No more old way

EXAMPLE - THROAT GRAB:
Old way: Tight/closed at back of tongue, grab at top of breath
New way: Finger between teeth, throat stays open at turnaround, passive drop`,
                    insights: `üí° MAJOR BREAKTHROUGHS:

1. THE TURNAROUND CONCEPT
   ‚Ä¢ Breath changes direction at the top like a rollercoaster
   ‚Ä¢ This is where the grab happens - need to stay open through it

2. PROACTIVE INHIBITION
   ‚Ä¢ Brain is PROTECTING the old pathway from going away
   ‚Ä¢ Why bad habits are SO persistent
   ‚Ä¢ Only way to override: bring error into CONSCIOUS awareness
   ‚Ä¢ Then brain can't do it automatically anymore

3. THE POWER OF FEELING DESCRIPTIONS
   ‚Ä¢ Verbal descriptions = bringing unconscious habit into consciousness
   ‚Ä¢ "What does the old way feel like?" - be specific!
   ‚Ä¢ "What does the new way feel like?" - be specific!

4. OLD WAY/NEW WAY EFFECTIVENESS
   ‚Ä¢ In ONE SESSION: 0% correct ‚Üí 80% correct
   ‚Ä¢ Permanent change (tested months later: 85-94% correct)
   ‚Ä¢ Works because it overrides proactive inhibition

5. THE 16-8 PROCESS
   ‚Ä¢ 64 reps throughout day (every 15 min for 16 waking hours)
   ‚Ä¢ Shows brain the correct feeling 64 times
   ‚Ä¢ Combined with message: builds new pathways OVERNIGHT
   ‚Ä¢ Brain consolidates during sleep

6. EYES CLOSED PRACTICE
   ‚Ä¢ Mirror/external feedback prevents kinesthetic awareness
   ‚Ä¢ Need to develop internal sense of what's correct
   ‚Ä¢ 80% of practice should be eyes closed`,
                    homework: `1. Master the turnaround drill - 100% consistent no-grab
   ‚Ä¢ Finger between teeth
   ‚Ä¢ Breathe to top
   ‚Ä¢ Don't grab - stay open
   ‚Ä¢ Passive drop
   ‚Ä¢ Eyes CLOSED for 80% of reps

2. Old Way/New Way on throat grab
   ‚Ä¢ Follow all 5 steps exactly
   ‚Ä¢ Don't skip the verbal descriptions
   ‚Ä¢ Video myself if possible

3. Set up 16-8 process
   ‚Ä¢ Phone reminder every 15 minutes
   ‚Ä¢ Quick 10-second drill each time
   ‚Ä¢ Say the message: "Playing feels like THIS"
   ‚Ä¢ Track with tally counter in app

4. Add "Throat grab at turnaround" to Error Trilogy
   ‚Ä¢ Fill out all three sections
   ‚Ä¢ Make it PRIMARY focus for this week

5. 80% eyes-closed practice target
   ‚Ä¢ Track this in daily sessions
   ‚Ä¢ Build kinesthetic awareness

6. Before bed: mentally review the CORRECT feeling
   ‚Ä¢ Brain consolidates during sleep
   ‚Ä¢ Give it the right information`,
                    avoid: `‚ùå DON'T accept "close enough" on throat engagement
‚ùå DON'T skip the verbal descriptions in Old Way/New Way (that's what brings it into consciousness)
‚ùå DON'T practice without clear intention
‚ùå DON'T skip eyes-closed work
‚ùå DON'T rely on mirror/external feedback long-term
‚ùå DON'T try to fix multiple errors at once
‚ùå DON'T get immediate feedback from teacher - develop self-correction first
‚ùå DON'T practice the error repeatedly UNLESS it's Step 2 of Old Way/New Way`,
                    focus: "Eliminate throat grab at turnaround using Old Way/New Way method",
                    notes: `Book: "Learn Faster, Perform Better" by Molly Gebrian
Chapter 3: "Use Errors to Your Advantage"

Key research findings:
‚Ä¢ Javelin thrower: 10% ‚Üí 90% correct after ONE Old Way/New Way session
‚Ä¢ Swimmer: 85% correct starts 3 days after intervention
‚Ä¢ Also improves psychological skills: anxiety control, concentration, self-confidence, motivation

The science:
‚Ä¢ Brain is a prediction machine
‚Ä¢ Errors surprise the brain more than correct actions
‚Ä¢ Proactive inhibition protects old pathways
‚Ä¢ Old Way/New Way brings automatic habits into conscious awareness
‚Ä¢ Once conscious, brain can self-correct

This is the foundation of EVERYTHING we're working on.`,
                    videoLink: "",
                    timestamp: "2025-01-15T10:00:00.000Z"
                }
            ],
            sliders: {
                throat: 0,
                meerkat: 0,
                passive: 0,
                arms: 0
            },
            quickTally: {
                date: new Date().toISOString().split('T')[0],
                count: 0,
                marks: [],
                drill: '',
                message: ''
            }
        };

        // Load data from localStorage
        function loadData() {
            const stored = localStorage.getItem('trumpetPracticeData');
            if (stored) {
                appData = JSON.parse(stored);
                
                // Ensure all arrays exist (for backward compatibility with old saved data)
                if (!appData.dailySessions) appData.dailySessions = [];
                if (!appData.weeklyReviews) appData.weeklyReviews = [];
                if (!appData.errorTrilogies) appData.errorTrilogies = [];
                if (!appData.effortlessMoments) appData.effortlessMoments = [];
                if (!appData.lessons) appData.lessons = [];
                if (!appData.sliders) appData.sliders = { throat: 0, meerkat: 0, passive: 0, arms: 0 };
                
                // Ensure quickTally exists and has marks array
                if (!appData.quickTally) {
                    appData.quickTally = {
                        date: new Date().toISOString().split('T')[0],
                        count: 0,
                        marks: [],
                        drill: '',
                        message: ''
                    };
                }
                
                if (!appData.quickTally.marks) {
                    appData.quickTally.marks = [];
                }
                
                // Reset tally if it's a new day
                const today = new Date().toISOString().split('T')[0];
                if (appData.quickTally.date !== today) {
                    appData.quickTally = {
                        date: today,
                        count: 0,
                        marks: [],
                        drill: appData.quickTally.drill || '',
                        message: appData.quickTally.message || ''
                    };
                    saveData();
                }
                
                updateStats();
                displayRecentSessions();
                displayTodaysSessions();
                displayPastWeeks();
                displayErrorLog();
                displayEffortlessLog();
                displayLessons();
                initializeSliders();
                
                // Initialize and update quick tally
                initQuickTally();
                
                // Restore quick tally settings
                document.getElementById('quick-drill-select').value = appData.quickTally.drill || '';
                document.getElementById('quick-message').value = appData.quickTally.message || '';
                if (appData.quickTally.drill === 'custom') {
                    document.getElementById('quick-drill-custom').style.display = 'block';
                }
            } else {
                // First time - initialize with empty data
                console.log('No stored data, initializing tally');
                initQuickTally();
            }
        }

        // Save data to localStorage
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('trumpetPracticeData', JSON.stringify(appData));
            
            // Auto-sync to GitHub if configured
            const { token, gistId } = getGitHubSettings();
            if (token && gistId) {
                syncToGist().catch(err => {
                    console.error('Auto-sync failed:', err);
                });
            }
        }

        // Show/hide sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'progress') {
                updateStats();
            }
        }

        // Quick Tally functions (at top of page)
        let tallyDebounceTimer;
        
        function initQuickTally() {
            console.log('initQuickTally called');
            const tallyContainer = document.getElementById('quick-tally');
            console.log('tallyContainer:', tallyContainer);
            
            if (!tallyContainer) {
                console.error('Tally container not found!');
                return; // Safety check
            }
            
            // Ensure marks array exists
            if (!appData.quickTally.marks) {
                appData.quickTally.marks = [];
                console.log('Initialized empty marks array');
            }
            
            console.log('Creating 64 tally marks...');
            tallyContainer.innerHTML = '';
            for (let i = 0; i < 64; i++) {
                const mark = document.createElement('div');
                mark.className = 'tally-mark';
                mark.dataset.index = i;
                if (appData.quickTally.marks.includes(i)) {
                    mark.classList.add('active');
                }
                mark.onclick = () => toggleQuickTally(mark, i);
                tallyContainer.appendChild(mark);
            }
            console.log('Tally marks created, calling updateQuickTallyCount');
            updateQuickTallyCount();
        }

        function toggleQuickTally(mark, index) {
            mark.classList.toggle('active');
            
            if (mark.classList.contains('active')) {
                if (!appData.quickTally.marks.includes(index)) {
                    appData.quickTally.marks.push(index);
                }
            } else {
                appData.quickTally.marks = appData.quickTally.marks.filter(i => i !== index);
            }
            
            appData.quickTally.count = appData.quickTally.marks.length;
            updateQuickTallyCount();
            
            // Save to localStorage immediately
            localStorage.setItem('trumpetPracticeData', JSON.stringify(appData));
            
            // Debounce GitHub sync - wait 3 seconds after last click
            clearTimeout(tallyDebounceTimer);
            tallyDebounceTimer = setTimeout(() => {
                const { token, gistId } = getGitHubSettings();
                if (token && gistId) {
                    syncToGist().catch(err => console.error('Tally sync failed:', err));
                }
            }, 3000);
        }

        function updateQuickTallyCount() {
            if (!appData.quickTally.marks) {
                appData.quickTally.marks = [];
            }
            
            const count = appData.quickTally.marks.length;
            const countElement = document.getElementById('quick-tally-count');
            const progressBar = document.getElementById('quick-progress');
            
            if (countElement) countElement.textContent = count;
            
            const percentage = Math.round((count / 64) * 100);
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = percentage + '%';
            }
        }

        function resetQuickTally() {
            if (!confirm('Reset today\'s tally counter?')) return;
            
            appData.quickTally.marks = [];
            appData.quickTally.count = 0;
            document.querySelectorAll('#quick-tally .tally-mark').forEach(m => m.classList.remove('active'));
            updateQuickTallyCount();
            saveData();
        }

        function saveQuickDrill() {
            const select = document.getElementById('quick-drill-select');
            appData.quickTally.drill = select.value;
            
            const customInput = document.getElementById('quick-drill-custom');
            if (select.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
            
            saveData(); // Sync to GitHub
        }

        function saveQuickMessage() {
            appData.quickTally.message = document.getElementById('quick-message').value;
            saveData(); // Sync to GitHub
        }

        function updateQuickTally() {
            initQuickTally();
            document.getElementById('quick-drill-select').value = appData.quickTally.drill || '';
            document.getElementById('quick-message').value = appData.quickTally.message || '';
        }

        // Auto-save draft as user types
        let autoSaveTimeout;
        function autoSaveDraft() {
            // Debounce - wait 1 second after user stops typing
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                const draft = {
                    date: document.getElementById('practice-date').value || new Date().toISOString().split('T')[0],
                    focus: Array.from(document.querySelectorAll('input[id^="focus-"]:checked')).map(cb => cb.value),
                    focusOther: document.getElementById('focus-other-text').value,
                    intention: document.getElementById('daily-intention').value,
                    leftBrain1: {
                        workingOn: document.getElementById('lb1-working-on').value,
                        intention: document.getElementById('lb1-intention').value,
                        error: document.getElementById('lb1-error').value,
                        drill: document.getElementById('lb1-drill').value,
                        message: document.getElementById('lb1-message').value,
                        reps: document.getElementById('lb1-reps').value,
                        success: document.getElementById('lb1-success').value,
                        notes: document.getElementById('lb1-notes').value
                    },
                    rightBrain1: {
                        played: document.getElementById('rb1-played').value,
                        errors: document.getElementById('rb1-errors').value,
                        good: document.getElementById('rb1-good').value
                    },
                    endOfDay: {
                        error: document.getElementById('eod-error').value,
                        feeling: document.getElementById('eod-feeling').value,
                        drill: document.getElementById('eod-drill').value,
                        correct: document.getElementById('eod-correct').value,
                        tomorrow: document.getElementById('eod-tomorrow').value
                    },
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('dailyPracticeDraft', JSON.stringify(draft));
                console.log('Draft auto-saved at', new Date().toLocaleTimeString());
            }, 1000);
        }

        // Load draft on page load
        function loadDraft() {
            const draft = localStorage.getItem('dailyPracticeDraft');
            if (!draft) return;
            
            try {
                const data = JSON.parse(draft);
                
                // Restore all form values
                document.getElementById('practice-date').value = data.date || '';
                document.getElementById('daily-intention').value = data.intention || '';
                document.getElementById('focus-other-text').value = data.focusOther || '';
                
                // Restore checkboxes
                if (data.focus) {
                    data.focus.forEach(val => {
                        const checkbox = document.querySelector(`input[value="${val}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                // Left brain
                document.getElementById('lb1-working-on').value = data.leftBrain1?.workingOn || '';
                document.getElementById('lb1-intention').value = data.leftBrain1?.intention || '';
                document.getElementById('lb1-error').value = data.leftBrain1?.error || '';
                document.getElementById('lb1-drill').value = data.leftBrain1?.drill || '';
                document.getElementById('lb1-message').value = data.leftBrain1?.message || '';
                document.getElementById('lb1-reps').value = data.leftBrain1?.reps || '0';
                document.getElementById('lb1-success').value = data.leftBrain1?.success || '';
                document.getElementById('lb1-notes').value = data.leftBrain1?.notes || '';
                
                // Right brain
                document.getElementById('rb1-played').value = data.rightBrain1?.played || '';
                document.getElementById('rb1-errors').value = data.rightBrain1?.errors || '';
                document.getElementById('rb1-good').value = data.rightBrain1?.good || '';
                
                // End of day
                document.getElementById('eod-error').value = data.endOfDay?.error || '';
                document.getElementById('eod-feeling').value = data.endOfDay?.feeling || '';
                document.getElementById('eod-drill').value = data.endOfDay?.drill || '';
                document.getElementById('eod-correct').value = data.endOfDay?.correct || '';
                document.getElementById('eod-tomorrow').value = data.endOfDay?.tomorrow || '';
                
                console.log('Draft restored from', new Date(data.lastSaved).toLocaleString());
            } catch (e) {
                console.error('Error loading draft:', e);
            }
        }

        // Clear draft after successful save
        function clearDraft() {
            localStorage.removeItem('dailyPracticeDraft');
        }

        // Save daily session
        function saveDailySession() {
            const session = {
                date: document.getElementById('practice-date').value || new Date().toISOString().split('T')[0],
                sessionTime: new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' }),
                focus: Array.from(document.querySelectorAll('input[id^="focus-"]:checked')).map(cb => cb.value),
                focusOther: document.getElementById('focus-other-text').value,
                intention: document.getElementById('daily-intention').value,
                leftBrain1: {
                    workingOn: document.getElementById('lb1-working-on').value,
                    intention: document.getElementById('lb1-intention').value,
                    error: document.getElementById('lb1-error').value,
                    drill: document.getElementById('lb1-drill').value,
                    message: document.getElementById('lb1-message').value,
                    reps: document.getElementById('lb1-reps').value,
                    success: document.getElementById('lb1-success').value,
                    notes: document.getElementById('lb1-notes').value
                },
                rightBrain1: {
                    played: document.getElementById('rb1-played').value,
                    errors: document.getElementById('rb1-errors').value,
                    good: document.getElementById('rb1-good').value
                },
                endOfDay: {
                    error: document.getElementById('eod-error').value,
                    feeling: document.getElementById('eod-feeling').value,
                    drill: document.getElementById('eod-drill').value,
                    correct: document.getElementById('eod-correct').value,
                    tomorrow: document.getElementById('eod-tomorrow').value
                },
                timestamp: new Date().toISOString()
            };

            appData.dailySessions.push(session);
            saveData();
            
            // Clear the draft since we saved successfully
            clearDraft();
            
            // Show success message
            const alert = document.getElementById('save-alert');
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);

            displayRecentSessions();
            displayTodaysSessions();
            updateStats();
        }

        // Display today's sessions
        function displayTodaysSessions() {
            const container = document.getElementById('todays-sessions');
            const today = document.getElementById('practice-date').value || new Date().toISOString().split('T')[0];
            const todaysSessions = appData.dailySessions.filter(s => s.date === today);
            
            if (todaysSessions.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">No sessions logged today yet.</p>';
                return;
            }

            container.innerHTML = todaysSessions.map((session, index) => `
                <div class="session-card" style="border-left-color: #27ae60;">
                    <h4>Session ${index + 1} - ${session.sessionTime || 'Time not recorded'}</h4>
                    <p><strong>Focus:</strong> ${session.intention || 'Not specified'}</p>
                    <p><strong>Working On:</strong> ${session.leftBrain1.workingOn || 'N/A'}</p>
                    <p><strong>Success Rate:</strong> ${session.leftBrain1.success || 'N/A'}</p>
                    ${session.rightBrain1.good ? `<p><strong>What Felt Good:</strong> ${session.rightBrain1.good}</p>` : ''}
                </div>
            `).join('');
        }

        // Display recent sessions
        function displayRecentSessions() {
            const container = document.getElementById('recent-sessions');
            const recent = appData.dailySessions.slice(-10).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">No sessions yet. Start logging your practice!</p>';
                return;
            }

            container.innerHTML = recent.map(session => `
                <div class="session-card">
                    <h4>${new Date(session.date).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} - ${session.sessionTime || ''}</h4>
                    <p><strong>Focus:</strong> ${session.intention || 'Not specified'}</p>
                    <p><strong>Working On:</strong> ${session.leftBrain1.workingOn || 'N/A'}</p>
                    <p><strong>Success Rate:</strong> ${session.leftBrain1.success || 'N/A'}</p>
                    ${session.endOfDay.error ? `<p><strong>Key Error:</strong> ${session.endOfDay.error}</p>` : ''}
                </div>
            `).join('');
        }

        // Clear daily form
        function clearDailyForm() {
            document.querySelectorAll('#daily input[type="text"], #daily input[type="number"], #daily textarea').forEach(el => el.value = '');
            document.querySelectorAll('#daily input[type="checkbox"]').forEach(el => el.checked = false);
            document.querySelectorAll('#daily select').forEach(el => el.selectedIndex = 0);
            
            // Set date to today
            document.getElementById('practice-date').value = new Date().toISOString().split('T')[0];
            
            // Clear the auto-saved draft
            clearDraft();
        }

        // Save weekly review
        function saveWeeklyReview() {
            const weekData = {
                weekOf: document.getElementById('week-of').value,
                mainIssue: document.getElementById('week-main-issue').value,
                dailyTracking: {},
                progress: document.querySelector('input[name="week-progress"]:checked')?.value,
                sliders: { ...appData.sliders },
                reflections: document.getElementById('week-reflections').value,
                timestamp: new Date().toISOString()
            };

            // Collect daily tracking data
            ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'].forEach(day => {
                weekData.dailyTracking[day] = {
                    intention: document.querySelector(`.week-check[data-day="${day}"][data-field="intention"]`).checked,
                    error: document.querySelector(`.week-check[data-day="${day}"][data-field="error"]`).checked,
                    drill: document.querySelector(`.week-check[data-day="${day}"][data-field="drill"]`).checked,
                    success: document.querySelector(`.week-success[data-day="${day}"]`).value,
                    notes: document.querySelector(`.week-notes[data-day="${day}"]`).value
                };
            });

            appData.weeklyReviews.push(weekData);
            saveData();
            
            alert('Weekly review saved!');
            displayPastWeeks();
        }

        // Display past weeks
        function displayPastWeeks() {
            const container = document.getElementById('past-weeks');
            const recent = appData.weeklyReviews.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">No weekly reviews yet.</p>';
                return;
            }

            container.innerHTML = recent.map(week => `
                <div class="session-card">
                    <h4>Week of ${new Date(week.weekOf).toLocaleDateString('en-GB')}</h4>
                    <p><strong>Main Issue:</strong> ${week.mainIssue}</p>
                    <p><strong>Progress:</strong> ${week.progress || 'Not specified'}</p>
                    ${week.reflections ? `<p><strong>Reflections:</strong> ${week.reflections}</p>` : ''}
                </div>
            `).join('');
        }

        // Clear weekly form
        function clearWeeklyForm() {
            if (!confirm('Clear the weekly review form?')) return;
            
            document.getElementById('week-of').value = '';
            document.getElementById('week-main-issue').value = '';
            document.getElementById('week-reflections').value = '';
            
            document.querySelectorAll('.week-check').forEach(el => el.checked = false);
            document.querySelectorAll('.week-success, .week-notes').forEach(el => el.value = '');
            document.querySelectorAll('input[name="week-progress"]').forEach(el => el.checked = false);
        }

        // Initialize sliders
        function initializeSliders() {
            const container = document.getElementById('sliders-container');
            const issues = [
                { key: 'throat', label: 'Throat grab at turnaround' },
                { key: 'meerkat', label: 'Meerkat/elevation' },
                { key: 'passive', label: 'Passive release' },
                { key: 'arms', label: 'Arm independence' }
            ];

            container.innerHTML = issues.map(issue => `
                <div class="slider-container">
                    <label>${issue.label}</label>
                    <div class="slider">
                        <div class="slider-marker" id="slider-${issue.key}" 
                             style="left: ${appData.sliders[issue.key]}%"
                             draggable="true"
                             ondragstart="dragStart(event, '${issue.key}')"
                             ondrag="drag(event, '${issue.key}')"
                             ondragend="dragEnd(event, '${issue.key}')"></div>
                    </div>
                    <div class="slider-labels">
                        <span>Unaware</span>
                        <span>I Know (locked)</span>
                    </div>
                </div>
            `).join('');
        }

        // Slider drag functions
        function dragStart(e, key) {
            e.dataTransfer.effectAllowed = 'move';
        }

        function drag(e, key) {
            if (e.clientX === 0) return; // Ignore invalid positions
            
            const slider = e.target.parentElement;
            const rect = slider.getBoundingClientRect();
            let percentage = ((e.clientX - rect.left) / rect.width) * 100;
            percentage = Math.max(0, Math.min(100, percentage));
            
            e.target.style.left = percentage + '%';
        }

        function dragEnd(e, key) {
            const slider = e.target.parentElement;
            const rect = slider.getBoundingClientRect();
            let percentage = ((e.clientX - rect.left) / rect.width) * 100;
            percentage = Math.max(0, Math.min(100, percentage));
            
            appData.sliders[key] = Math.round(percentage);
            e.target.style.left = percentage + '%';
            saveData();
        }

        // Save error trilogy
        function saveErrorTrilogy() {
            const error = {
                name: document.getElementById('error-name').value,
                detection: {
                    feel: document.getElementById('detect-feel').checked,
                    see: document.getElementById('detect-see').checked,
                    hear: document.getElementById('detect-hear').checked,
                    told: document.getElementById('detect-told').checked,
                    when: document.getElementById('error-when').value,
                    where: document.getElementById('error-where').value
                },
                rejection: {
                    why: document.getElementById('error-why').value,
                    urgency: document.getElementById('error-urgency').value,
                    statement: document.getElementById('error-statement').value
                },
                correction: {
                    drill: document.getElementById('error-drill').value,
                    correctFeeling: document.getElementById('error-correct-feel').value,
                    message: document.getElementById('error-message').value,
                    dailyReps: document.getElementById('error-reps').value
                },
                timestamp: new Date().toISOString()
            };

            appData.errorTrilogies.push(error);
            saveData();
            
            alert('Error trilogy saved!');
            displayErrorLog();
            updateStats();
        }

        // Display error log
        function displayErrorLog() {
            const container = document.getElementById('error-log');
            
            if (appData.errorTrilogies.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">No errors logged yet.</p>';
                return;
            }

            container.innerHTML = appData.errorTrilogies.slice().reverse().map((error, index) => `
                <div class="error-log">
                    <h4>${error.name}</h4>
                    <p><strong>Urgency:</strong> ${error.rejection.urgency}/10</p>
                    <p><strong>Zero Tolerance:</strong> ${error.rejection.statement}</p>
                    <p><strong>Opposing Drill:</strong> ${error.correction.drill}</p>
                    <p><strong>Message:</strong> ${error.correction.message}</p>
                    <p><strong>Daily Target:</strong> ${error.correction.dailyReps} reps</p>
                    <p style="font-size: 0.85em; color: #7f8c8d;">Logged: ${new Date(error.timestamp).toLocaleDateString()}</p>
                </div>
            `).join('');
        }

        // Clear error form
        function clearErrorForm() {
            if (!confirm('Clear the error trilogy form?')) return;
            
            document.querySelectorAll('#errors input[type="text"], #errors textarea').forEach(el => el.value = '');
            document.querySelectorAll('#errors input[type="checkbox"]').forEach(el => el.checked = false);
            document.getElementById('error-urgency').value = 5;
            document.getElementById('urgency-value').textContent = 5;
            document.getElementById('error-reps').value = 64;
        }

        // Save effortless moment
        function saveEffortlessMoment() {
            const moment = {
                date: document.getElementById('effortless-date').value,
                activity: document.getElementById('effortless-activity').value,
                timestamp: new Date().toISOString()
            };

            if (!moment.date || !moment.activity) {
                alert('Please fill in both date and activity');
                return;
            }

            appData.effortlessMoments.push(moment);
            saveData();
            
            document.getElementById('effortless-date').value = '';
            document.getElementById('effortless-activity').value = '';
            
            alert('‚ú® Effortless moment saved!');
            displayEffortlessLog();
        }

        // Display effortless log
        function displayEffortlessLog() {
            const container = document.getElementById('effortless-log');
            
            if (appData.effortlessMoments.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d; margin-top: 20px;">No effortless moments logged yet. These are worth celebrating!</p>';
                return;
            }

            container.innerHTML = '<h4 style="margin-top: 20px;">Your Effortless Moments:</h4>' + 
                appData.effortlessMoments.slice().reverse().map(moment => `
                    <div class="session-card" style="border-left-color: #27ae60;">
                        <p><strong>Date:</strong> ${new Date(moment.date).toLocaleDateString('en-GB')}</p>
                        <p><strong>Activity:</strong> ${moment.activity}</p>
                    </div>
                `).join('');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('stat-sessions').textContent = appData.dailySessions.length;
            document.getElementById('stat-errors').textContent = appData.errorTrilogies.length;
            
            // Calculate streak
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Get unique practice dates
            const uniqueDates = [...new Set(appData.dailySessions.map(s => s.date))]
                .map(d => new Date(d))
                .sort((a, b) => b - a);
            
            for (let i = 0; i < uniqueDates.length; i++) {
                const sessionDate = new Date(uniqueDates[i]);
                sessionDate.setHours(0, 0, 0, 0);
                const daysDiff = Math.floor((today - sessionDate) / (1000 * 60 * 60 * 24));
                
                if (daysDiff === i) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('stat-streak').textContent = streak;
            
            // Estimate total practice time (assuming 30-45 min per session)
            const estimatedMinutes = appData.dailySessions.length * 35;
            document.getElementById('stat-time').textContent = estimatedMinutes;
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `trumpet-practice-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData() {
            const file = document.getElementById('import-file').files[0];
            if (!file) {
                alert('Please select a file first');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('This will replace all current data. Continue?')) {
                        appData = imported;
                        saveData();
                        location.reload();
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // Reset all data
        function resetAllData() {
            const confirmation = prompt('Type "DELETE ALL" to confirm reset:');
            if (confirmation === 'DELETE ALL') {
                localStorage.removeItem('trumpetPracticeData');
                location.reload();
            } else {
                alert('Reset cancelled');
            }
        }

        // Initialize app on load
        window.onload = () => {
            console.log('Window loaded');
            console.log('appData:', appData);
            loadData();
            console.log('After loadData, appData:', appData);
            initQuickTally();
            initializeSliders();
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('practice-date').value = today;
            document.getElementById('effortless-date').value = today;
            document.getElementById('lesson-date').value = today;
            
            // Load any saved draft
            loadDraft();
            
            // Load GitHub settings
            loadGitHubSettings();
            
            console.log('Initialization complete');
        };

        // Toggle help sections
        function toggleHelp(helpId) {
            const helpContent = document.getElementById(helpId);
            const toggle = event.currentTarget;
            
            helpContent.classList.toggle('active');
            toggle.classList.toggle('active');
        }

        // Save lesson
        function saveLesson() {
            const lesson = {
                date: document.getElementById('lesson-date').value,
                teacher: document.getElementById('lesson-teacher').value,
                lessonNumber: document.getElementById('lesson-number').value,
                discoveries: document.getElementById('lesson-discoveries').value,
                process: document.getElementById('lesson-process').value,
                insights: document.getElementById('lesson-insights').value,
                homework: document.getElementById('lesson-homework').value,
                avoid: document.getElementById('lesson-avoid').value,
                focus: document.getElementById('lesson-focus').value,
                notes: document.getElementById('lesson-notes').value,
                videoLink: document.getElementById('lesson-video').value,
                timestamp: new Date().toISOString()
            };

            if (!lesson.date) {
                alert('Please enter a lesson date');
                return;
            }

            appData.lessons.push(lesson);
            saveData();
            
            const alert = document.getElementById('lesson-save-alert');
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
            
            displayLessons();
            clearLessonForm();
        }

        // Display lessons
        function displayLessons() {
            const container = document.getElementById('lessons-list');
            
            if (appData.lessons.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">No lessons logged yet. Add your first lesson above!</p>';
                return;
            }

            const lessons = appData.lessons.slice().reverse();
            
            container.innerHTML = lessons.map((lesson, index) => `
                <div class="session-card" style="border-left-color: #9b59b6;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4>
                                ${lesson.lessonNumber ? `Lesson #${lesson.lessonNumber} - ` : ''}
                                ${new Date(lesson.date).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </h4>
                            ${lesson.teacher ? `<p style="color: #7f8c8d; font-size: 0.9em;">Teacher: ${lesson.teacher}</p>` : ''}
                        </div>
                        <button class="danger" onclick="deleteLesson(${appData.lessons.length - 1 - index})" style="padding: 5px 10px; font-size: 0.85em;">Delete</button>
                    </div>
                    
                    ${lesson.focus ? `
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 3px solid #f39c12;">
                            <strong>üéØ Primary Focus:</strong> ${lesson.focus}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 15px;">
                        <button class="secondary" onclick="toggleLessonDetails(${appData.lessons.length - 1 - index})" style="font-size: 0.9em;">
                            üìñ View Full Details
                        </button>
                        ${lesson.videoLink ? `
                            <a href="${lesson.videoLink}" target="_blank" style="margin-left: 10px;">
                                <button class="secondary" style="font-size: 0.9em;">üé• Watch Video</button>
                            </a>
                        ` : ''}
                    </div>
                    
                    <div id="lesson-details-${appData.lessons.length - 1 - index}" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        
                        ${lesson.discoveries ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">üìå Key Discoveries</h5>
                                <p style="white-space: pre-wrap;">${lesson.discoveries}</p>
                            </div>
                        ` : ''}
                        
                        ${lesson.process ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">üîß Specific Process</h5>
                                <p style="white-space: pre-wrap; background: #f8f9fa; padding: 10px; border-radius: 5px;">${lesson.process}</p>
                            </div>
                        ` : ''}
                        
                        ${lesson.insights ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">üí° Key Insights</h5>
                                <p style="white-space: pre-wrap;">${lesson.insights}</p>
                            </div>
                        ` : ''}
                        
                        ${lesson.homework ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">üìã Homework</h5>
                                <p style="white-space: pre-wrap; background: #d4edda; padding: 10px; border-radius: 5px;">${lesson.homework}</p>
                            </div>
                        ` : ''}
                        
                        ${lesson.avoid ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">‚ö†Ô∏è What NOT to Do</h5>
                                <p style="white-space: pre-wrap; background: #fff5f5; padding: 10px; border-radius: 5px;">${lesson.avoid}</p>
                            </div>
                        ` : ''}
                        
                        ${lesson.notes ? `
                            <div style="margin-bottom: 15px;">
                                <h5 style="color: #e67e22; margin-bottom: 5px;">üìù Additional Notes</h5>
                                <p style="white-space: pre-wrap; color: #555;">${lesson.notes}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Toggle lesson details
        function toggleLessonDetails(index) {
            const details = document.getElementById(`lesson-details-${index}`);
            const button = event.target;
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                button.textContent = 'üìñ Hide Details';
            } else {
                details.style.display = 'none';
                button.textContent = 'üìñ View Full Details';
            }
        }

        // Delete lesson
        function deleteLesson(index) {
            if (!confirm('Delete this lesson? This cannot be undone.')) return;
            
            appData.lessons.splice(index, 1);
            saveData();
            displayLessons();
        }

        // Clear lesson form
        function clearLessonForm() {
            document.getElementById('lesson-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('lesson-teacher').value = '';
            document.getElementById('lesson-number').value = '';
            document.getElementById('lesson-discoveries').value = '';
            document.getElementById('lesson-process').value = '';
            document.getElementById('lesson-insights').value = '';
            document.getElementById('lesson-homework').value = '';
            document.getElementById('lesson-avoid').value = '';
            document.getElementById('lesson-focus').value = '';
            document.getElementById('lesson-notes').value = '';
            document.getElementById('lesson-video').value = '';
        }

        // GitHub Gist Sync Functions
        let syncLog = [];
        
        function addToSyncLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            syncLog.unshift(`[${timestamp}] ${message}`);
            if (syncLog.length > 20) syncLog.pop();
            
            const logDiv = document.getElementById('sync-log');
            if (logDiv) {
                logDiv.innerHTML = syncLog.join('\n') || 'No sync activity yet';
            }
            console.log(`[SYNC] ${message}`);
        }

        function getGitHubSettings() {
            const token = localStorage.getItem('github_token');
            const gistId = localStorage.getItem('gist_id');
            return { token, gistId };
        }

        function saveGitHubSettings(token, gistId) {
            if (token) localStorage.setItem('github_token', token);
            if (gistId) localStorage.setItem('gist_id', gistId);
        }

        async function testConnection() {
            const { token } = getGitHubSettings();
            
            if (!token) {
                alert('Please enter your GitHub token first');
                return;
            }

            addToSyncLog('Testing connection...');
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    addToSyncLog(`‚úÖ Connected as ${user.login}`);
                    showSyncStatus(`‚úÖ Connected to GitHub as ${user.login}`, 'success');
                } else {
                    addToSyncLog('‚ùå Connection failed - check token');
                    showSyncStatus('‚ùå Connection failed - check your token', 'error');
                }
            } catch (error) {
                addToSyncLog(`‚ùå Error: ${error.message}`);
                showSyncStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function syncToGist() {
            const { token, gistId } = getGitHubSettings();
            
            if (!token) {
                return false; // Silent fail for auto-sync
            }

            addToSyncLog('Syncing to GitHub...');
            
            try {
                const gistData = {
                    description: 'Trumpet Practice Tracker Data',
                    public: false,
                    files: {
                        'trumpet-practice-data.json': {
                            content: JSON.stringify(appData, null, 2)
                        }
                    }
                };

                let response;
                if (gistId) {
                    // Update existing gist
                    response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                } else {
                    // Create new gist
                    response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                }

                if (response.ok) {
                    const gist = await response.json();
                    saveGitHubSettings(token, gist.id);
                    const gistIdField = document.getElementById('gist-id');
                    if (gistIdField) gistIdField.value = gist.id;
                    
                    const now = new Date().toLocaleString();
                    localStorage.setItem('last_sync', now);
                    
                    addToSyncLog(`‚úÖ Synced (ID: ${gist.id.substring(0, 8)}...)`);
                    return true;
                } else {
                    const error = await response.json();
                    addToSyncLog(`‚ùå Sync failed: ${error.message}`);
                    return false;
                }
            } catch (error) {
                addToSyncLog(`‚ùå Error: ${error.message}`);
                return false;
            }
        }

        async function syncFromGist() {
            const { token, gistId } = getGitHubSettings();
            
            if (!token || !gistId) {
                alert('Please enter both GitHub token and Gist ID');
                return;
            }

            addToSyncLog('Pulling from GitHub...');
            
            try {
                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const gist = await response.json();
                    const fileContent = gist.files['trumpet-practice-data.json'].content;
                    const data = JSON.parse(fileContent);
                    
                    if (confirm('Replace local data with data from GitHub?\n\nClick OK to replace, Cancel to keep local data.')) {
                        appData = data;
                        localStorage.setItem('trumpetPracticeData', JSON.stringify(appData));
                        location.reload();
                    }
                    
                    addToSyncLog('‚úÖ Pulled from GitHub');
                    showSyncStatus('‚úÖ Data loaded from GitHub', 'success');
                } else {
                    const error = await response.json();
                    addToSyncLog(`‚ùå Pull failed: ${error.message}`);
                    showSyncStatus(`‚ùå Pull failed: ${error.message}`, 'error');
                }
            } catch (error) {
                addToSyncLog(`‚ùå Error: ${error.message}`);
                showSyncStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function saveSettingsAndSync() {
            const token = document.getElementById('github-token').value.trim();
            
            if (!token) {
                alert('Please enter your GitHub token');
                return;
            }

            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                alert('Token should start with "ghp_" or "github_pat_". Please check your token.');
                return;
            }

            saveGitHubSettings(token, null);
            addToSyncLog('Settings saved');
            showSyncStatus('‚è≥ Syncing to GitHub...', 'info');
            
            // Do initial sync
            syncToGist().then(success => {
                if (success) {
                    showSyncStatus('‚úÖ Settings saved and synced to GitHub!', 'success');
                }
            });
        }

        function showSyncStatus(message, type) {
            const statusDiv = document.getElementById('sync-status');
            const statusText = document.getElementById('sync-status-text');
            
            if (statusDiv && statusText) {
                statusText.textContent = message;
                statusDiv.className = 'alert';
                if (type === 'error') {
                    statusDiv.style.background = '#fff5f5';
                    statusDiv.style.borderColor = '#e74c3c';
                } else {
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.borderColor = '#27ae60';
                }
                statusDiv.style.display = 'block';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Load GitHub settings on page load
        function loadGitHubSettings() {
            const { token, gistId } = getGitHubSettings();
            const lastSync = localStorage.getItem('last_sync');
            
            const tokenField = document.getElementById('github-token');
            const gistIdField = document.getElementById('gist-id');
            
            if (tokenField && token) {
                tokenField.value = token;
            }
            
            if (gistIdField && gistId) {
                gistIdField.value = gistId;
                addToSyncLog(`Gist ID: ${gistId.substring(0, 8)}...`);
            }
            
            if (lastSync) {
                addToSyncLog(`Last sync: ${lastSync}`);
            }
        }

        // Toggle help sections
        function toggleHelp(helpId) {
            const helpContent = document.getElementById(helpId);
            const toggle = event.currentTarget;
            
            helpContent.classList.toggle('active');
            toggle.classList.toggle('active');
        }
    </script>
</body>
</html>